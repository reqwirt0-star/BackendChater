// server/server.js

// 1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹
const express = require('express');
const cors = require('cors');
const bodyParser = require('body-parser');

// 2. Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
const app = express();
const port = 3000; // ÐŸÐ¾Ñ€Ñ‚, Ð½Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð±ÑƒÐ´ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð°Ñˆ ÑÐµÑ€Ð²ÐµÑ€

// 3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ "Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð¾Ðµ ÐŸÐž" (middleware)
app.use(cors()); // Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð² (Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ index.html)
app.use(bodyParser.json()); // ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ JSON Ð¸Ð· Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°

// 4. ðŸ”¥ Ð“Ð›ÐÐ’ÐÐžÐ•: Ð£Ñ‡Ñ‘Ñ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð·Ð´ÐµÑÑŒ, Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ!
// ÐžÐ½Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐµ ÐÐ• Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ.
// Ð¡Ð¢ÐÐ›Ðž:
const credentials = require('./users.json');
];

// 5. Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ (Ð°Ð´Ñ€ÐµÑ) Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð»Ð¾Ð³Ð¸Ð½Ð°
app.post('/login', (req, res) => {
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð»Ð¾Ð³Ð¸Ð½ Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¸Ð· Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¸ÑˆÐ»Ñ‘Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚
    const { username, password } = req.body;

    // Ð˜Ñ‰ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð² Ð½Ð°ÑˆÐµÐ¼ Ð¼Ð°ÑÑÐ¸Ð²Ðµ
    const user = credentials.find(u => u.username === username && u.password === password);

    if (user) {
        // ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¹Ð´ÐµÐ½. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ (200 OK)
        console.log(`Successfull login for user: ${username}`);
        res.status(200).json({
            success: true,
            // Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð·Ð´ÐµÑÑŒ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½ (JWT)
            token: 'secret-auth-token-for-' + username
        });
    } else {
        // ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¾ÑˆÐ¸Ð±ÐºÑƒ (401 Unauthorized)
        console.log(`Failed login attempt for user: ${username}`);
        res.status(401).json({
            success: false,
            message: 'ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ. Ð¡Ð²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð¼.'
        });
    }
});

// 6. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€
app.listen(port, () => {
    console.log(`âœ… Secure server is running at http://localhost:${port}`);
});